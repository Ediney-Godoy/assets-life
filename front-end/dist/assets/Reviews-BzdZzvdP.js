import{c as oe,u as ia,a as la,R as i,g as da,b as na,d as ca,e as ma,f as ua,j as a,A as pa,I as p,S as Ce,B as h,h as re,T as _a,m as $,X as A,z as c,i as xa,k as ha,l as va,n as ba,o as ga,p as fa,_ as Se}from"./index-BSlTwEBF.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],Ee=oe("file-down",ja);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],wa=oe("lock",ya);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Re=oe("upload",Na);function Ca(){const{t:s}=ia();la();const[ie,De]=i.useState([]),[le,Fe]=i.useState([]),[k,Pe]=i.useState([]),[D,Ue]=i.useState([]),[Le,B]=i.useState(!1),[T,G]=i.useState(""),[$e,z]=i.useState(!1),[V,X]=i.useState(""),[de,ne]=i.useState(!0),[ce,me]=i.useState(null),[ue,Ae]=i.useState(""),[Q,Be]=i.useState(""),[u,H]=i.useState(null),[y,F]=i.useState({}),[C,ze]=i.useState([]),[qe,q]=i.useState(!1),[Y,W]=i.useState(""),[Ie,I]=i.useState(!1),[Oe,O]=i.useState(!1),[b,J]=i.useState(null),[_,K]=i.useState(null),[P,Z]=i.useState(!1),[pe,Me]=i.useState(0),[ee,Te]=i.useState([]),[Ge,U]=i.useState(!1),[r,S]=i.useState({descricao:"",data_abertura:"",data_inicio_nova_vida_util:"",data_fechamento_prevista:"",data_fechamento:"",empresa_id:"",responsavel_id:"",ug_id:"",status:"Aberto",observacoes:"",codigo:""}),L=i.useCallback(()=>{ne(!0),me(null),Promise.all([da(),na(),ca(),ma(),ua()]).then(([e,t,o,d,n])=>{De(e||[]),Fe(t||[]),Pe(o||[]),Ue(d||[]),ze(n||[])}).catch(e=>me(e.message||s("error_generic")||"Erro")).finally(()=>ne(!1))},[]);i.useEffect(()=>{L()},[L]);const _e=()=>{H(null),F({}),S({descricao:"",data_abertura:"",data_inicio_nova_vida_util:"",data_fechamento_prevista:"",data_fechamento:"",empresa_id:"",responsavel_id:"",ug_id:"",status:"Aberto",observacoes:"",codigo:""}),G(""),X(""),W("")},w=e=>{const{name:t,value:o}=e.target;S(d=>({...d,[t]:o}))},Ve=()=>{const e={};return r.descricao||(e.descricao="Descrição é obrigatória"),r.data_abertura||(e.data_abertura="Data de abertura é obrigatória"),r.data_inicio_nova_vida_util||(e.data_inicio_nova_vida_util=s("field_required")||"Início da nova vida útil é obrigatório"),r.data_fechamento_prevista||(e.data_fechamento_prevista="Data de fechamento prevista é obrigatória"),r.empresa_id||(e.empresa_id="Empresa é obrigatória"),r.ug_id||(e.ug_id="UG é obrigatória"),r.responsavel_id||(e.responsavel_id=s("field_required")||"Responsável é obrigatório"),["Aberto","Em Andamento","Fechado"].includes(r.status)||(e.status=s("invalid_status")||"Status inválido"),F(e),Object.keys(e).length===0},Xe=async()=>{if(Ve())try{if(u){const e={descricao:r.descricao,data_abertura:r.data_abertura||void 0,data_inicio_nova_vida_util:r.data_inicio_nova_vida_util||void 0,data_fechamento_prevista:r.data_fechamento_prevista||void 0,data_fechamento:r.data_fechamento||void 0,empresa_id:r.empresa_id?Number(r.empresa_id):void 0,responsavel_id:r.responsavel_id?Number(r.responsavel_id):void 0,ug_id:r.ug_id?Number(r.ug_id):void 0,status:r.status,observacoes:r.observacoes||void 0};await ha(u,e),c.success(s("updated_successfully")||"Período atualizado com sucesso")}else{const e={descricao:r.descricao,data_abertura:r.data_abertura,data_inicio_nova_vida_util:r.data_inicio_nova_vida_util,data_fechamento_prevista:r.data_fechamento_prevista,empresa_id:Number(r.empresa_id),responsavel_id:Number(r.responsavel_id),ug_id:Number(r.ug_id),status:r.status,observacoes:r.observacoes||null},t=await xa(e);c.success(s("created_successfully")||"Período criado com sucesso"),H(t.id)}await L()}catch(e){c.error(e.message||s("error_saving")||"Erro ao salvar")}},ae=e=>{H(e.id),S({descricao:e.descricao||"",data_abertura:e.data_abertura||"",data_inicio_nova_vida_util:e.data_inicio_nova_vida_util||"",data_fechamento_prevista:e.data_fechamento_prevista||"",data_fechamento:e.data_fechamento||"",empresa_id:String(e.empresa_id||""),responsavel_id:String(e.responsavel_id||""),ug_id:String(e.ug_id||""),status:e.status||"Aberto",observacoes:e.observacoes||"",codigo:e.codigo||""})},Qe=async e=>{if(confirm(s("confirm_delete_period")||"Confirmar exclusão do período?"))try{await va(e),c.success(s("deleted_successfully")||"Período excluído"),u===e&&_e(),await L()}catch(t){c.error(t.message||s("error_deleting")||"Erro ao excluir")}},He=async()=>{if(!u)return c.error(s("select_period_msg")||"Selecione um período");try{const e=await ba(u);c.success(s("period_closed")||"Período fechado"),ae(e),await L()}catch(e){c.error(e.message||s("error_closing_period")||"Erro ao fechar período")}},se=i.useRef(null),Ye=()=>{if(!u)return c.error(s("select_period_msg")||"Selecione um período");if(r.status==="Fechado")return c.error(s("period_closed_upload_not_allowed")||"Período está fechado. Upload não permitido.");I(!0),O(!1),Z(!1),J(null),K(null)},xe=e=>{if(!e)return;const t=(e.name||"").toLowerCase();if(!(t.endsWith(".csv")||t.endsWith(".xlsx"))){c.error(s("invalid_file_format")||"Formato inválido. Envie .csv ou .xlsx");return}J(e)},he=e=>{var o;const t=(o=e.target.files)==null?void 0:o[0];e.target.value="",t&&xe(t)},We=e=>{var o,d;e.preventDefault(),O(!1);const t=(d=(o=e.dataTransfer)==null?void 0:o.files)==null?void 0:d[0];t&&xe(t)},Je=e=>{try{e=e.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")}catch{}return e=String(e||"").trim().toLowerCase(),e=e.replace(/[^a-z0-9]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),e},Ke=async e=>{try{const t=await Se(()=>import("./xlsx-D_0l8YDs.js"),[]);let o;if(String((e==null?void 0:e.name)||"").toLowerCase().endsWith(".csv")){const l=await e.text();o=t.read(l,{type:"string"})}else{const l=await e.arrayBuffer();o=t.read(new Uint8Array(l),{type:"array"})}const n=o.Sheets[o.SheetNames[0]],m=t.utils.sheet_to_json(n,{header:1,defval:""});if(!m||m.length<2)return{count:0,samples:[]};const f=m[0].map(l=>Je(String(l))).findIndex(l=>l==="vida_util_anos");if(f===-1)return{count:0,samples:[]};let j=0;const v=[];for(let l=1;l<m.length;l++)String(m[l][f]??"").trim()===""&&(j++,v.length<10&&v.push(l+1));return{count:j,samples:v}}catch{return{count:0,samples:[]}}},ve=async()=>{if(!u)return c.error(s("select_period_msg")||"Selecione um período");if(!b)return c.error(s("select_file_msg")||"Selecione um arquivo");try{Z(!0);const e=await ga(u,b);K(e);const t=Array.isArray(e.alertas)?e.alertas.length:0,o=`Importação: ${e.importados} importados, ${e.rejeitados} rejeitados`+(t?`, ${t} alertas`:".");c.success(o);try{await fa(u)}catch{}}catch(e){const t=String((e==null?void 0:e.message)||""),o=(e==null?void 0:e.name)==="AbortError"||/Tempo limite|aborted|AbortError/i.test(t),d=/Failed to fetch|net::ERR_FAILED/i.test(t),n=/ERR_UPLOAD_FILE_CHANGED/i.test(t);let m="";o?m=s("timeout_error")||"Tempo limite atingido. Tente novamente ou reduza o tamanho do arquivo.":n?m=s("upload_file_changed")||"O arquivo foi alterado após a seleção. Feche-o e selecione novamente.":d?m=s("network_failed")||"Falha de rede ao enviar. Verifique proxy/extensões/antivírus ou tente outro navegador.":m=t&&t.length>=4?t:s("upload_failed")||"Falha no upload",c.error(m)}finally{Z(!1)}},be=async()=>{if(!u)return c.error(s("select_period_msg")||"Selecione um período");if(!b)return c.error(s("select_file_msg")||"Selecione um arquivo");const e=await Ke(b);if(e.count>0){Me(e.count),Te(e.samples),U(!0);return}await ve()},E=(ie||[]).filter(e=>!Q||e.status===Q).filter(e=>{const t=ue.toLowerCase();return(e.codigo||"").toLowerCase().includes(t)||(e.descricao||"").toLowerCase().includes(t)||(e.status||"").toLowerCase().includes(t)}).sort((e,t)=>e.id<t.id?1:-1),Ze=[{key:"codigo",header:s("period_code")||"Código",width:120},{key:"descricao",header:s("period_description")||"Descrição do Período"},{key:"data_abertura",header:s("open_date")||"Data de Abertura",width:140},{key:"empresa_id",header:s("company_label")||"Empresa",width:220,render:e=>{const t=k.find(o=>o.id===e);return t?t.name:"—"}},{key:"ug_id",header:s("ug_label")||"UG",width:220,render:e=>{const t=C.find(o=>o.id===e);return t?`${t.codigo} - ${t.nome}`:"—"}},{key:"responsavel_id",header:s("review_responsible")||"Responsável",width:220,render:e=>{const t=D.find(o=>o.id===e);return t?t.nome_completo:"—"}},{key:"status",header:s("status")||"Status",width:140}],R=e=>{if(!e)return"";try{return new Date(e).toLocaleDateString("pt-BR")}catch{return String(e||"")}},ea=async()=>{const e=[s("period_code")||"Código da Revisão",s("period_description")||"Descrição do Período",s("company_label")||"Empresa",s("ug_label")||"UG",s("review_responsible")||"Responsável pela Revisão",s("open_date")||"Data de Abertura",s("start_new_useful_life")||"Início Nova Depreciação",s("close_date")||"Data de Fechamento"],t=E.map(l=>{var Ne,ke;const M=((Ne=k.find(N=>N.id===l.empresa_id))==null?void 0:Ne.name)||"",ta=(()=>{const N=C.find(oa=>oa.id===l.ug_id);return N?`${N.codigo} - ${N.nome}`:""})(),ra=((ke=D.find(N=>N.id===l.responsavel_id))==null?void 0:ke.nome_completo)||"";return{[e[0]]:l.codigo||"",[e[1]]:l.descricao||"",[e[2]]:M,[e[3]]:ta,[e[4]]:ra,[e[5]]:R(l.data_abertura),[e[6]]:R(l.data_inicio_nova_vida_util),[e[7]]:R(l.data_fechamento)}}),o=await Se(()=>import("./xlsx-D_0l8YDs.js"),[]),d=o.default||o,n=d.utils.json_to_sheet(t,{header:e}),m=d.utils.book_new();d.utils.book_append_sheet(m,n,"Períodos");const g=d.write(m,{bookType:"xlsx",type:"array"}),f=new Blob([g],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),j=URL.createObjectURL(f),v=document.createElement("a");v.href=j,v.download="Periodos_Revisao.xlsx",v.click(),URL.revokeObjectURL(j),c.success(s("export_excel")||"Exportar Excel")},aa=()=>{const e=s("review_periods_register_title")||"Períodos de Revisão de Vidas Úteis",t=`
      <tr>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("period_code")||"Código da Revisão"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("period_description")||"Descrição do Período"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("company_label")||"Empresa"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("ug_label")||"UG"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("review_responsible")||"Responsável pela Revisão"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("open_date")||"Data de Abertura"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("start_new_useful_life")||"Início Nova Depreciação"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("close_date")||"Data de Fechamento"}</th>
      </tr>`,o=E.map(n=>{var j,v;const m=((j=k.find(l=>l.id===n.empresa_id))==null?void 0:j.name)||"",g=(()=>{const l=C.find(M=>M.id===n.ug_id);return l?`${l.codigo} - ${l.nome}`:""})(),f=((v=D.find(l=>l.id===n.responsavel_id))==null?void 0:v.nome_completo)||"";return`
        <tr>
          <td style="padding:8px;border:1px solid #e5e7eb">${n.codigo||""}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${n.descricao||""}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${m}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${g}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${f}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${R(n.data_abertura)}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${R(n.data_inicio_nova_vida_util)}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${R(n.data_fechamento)}</td>
        </tr>`}).join("");return`<!doctype html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>${e}</title>
        <style>
          @page { margin: 20mm; }
          body { font-family: Arial, sans-serif; color: #0f172a; }
          .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
          .brand { display:flex; align-items:center; gap:10px; }
          .brand img { height:40px; }
          .brand .title { font-size:18px; font-weight:600; }
          table { width:100%; border-collapse: collapse; }
          thead { background:#f8fafc; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="brand">
            <img src="/brand.svg" alt="Logo" />
            <div class="title">${e}</div>
          </div>
          <div style="font-size:12px;color:#64748b">${new Date().toLocaleString("pt-BR")}</div>
        </div>
        <table>
          <thead>${t}</thead>
          <tbody>${o}</tbody>
        </table>
      </body>
      </html>`},sa=()=>{const e=window.open("","PRINT","height=800,width=900");e.document.write(aa()),e.document.close(),e.focus(),e.print(),e.close(),c.success(s("export_pdf")||"Exportar PDF")},x=r.status==="Fechado",ge=k.find(e=>e.id===Number(r.empresa_id)),fe=k.filter(e=>!T||(e.name||"").toLowerCase().includes(T.toLowerCase())),je=D.find(e=>e.id===Number(r.responsavel_id)),te=C.find(e=>e.id===Number(r.ug_id)),ye=i.useMemo(()=>{const e=(Y||"").trim().toLowerCase();let t=C||[];return r.empresa_id&&(t=t.filter(o=>String(o.empresa_id)===String(r.empresa_id))),e?t.filter(o=>String(o.codigo||"").toLowerCase().includes(e)||String(o.nome||"").toLowerCase().includes(e)).slice(0,100):t.slice(0,50)},[Y,C,r.empresa_id]),we=i.useMemo(()=>{const e=(V||"").trim().toLowerCase();let t=le||[];if(r.empresa_id&&(t=t.filter(d=>String(d.empresa_id)===String(r.empresa_id))),t=t.filter(d=>String(d.status||"").toLowerCase()==="ativo"),!e)return t.slice(0,100);const o=e.replace(/\D/g,"");return t.filter(d=>{const n=String(d.full_name||"").toLowerCase(),m=String(d.email_corporativo||"").toLowerCase(),g=String(d.cpf||"").replace(/\D/g,""),f=String(d.matricula||"").toLowerCase();return n.includes(e)||m.includes(e)||f.includes(e)||o&&g.includes(o)}).slice(0,100)},[V,le,r.empresa_id]);return a.jsxs("section",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[a.jsx("h2",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:s("review_periods_register_title")||"Cadastro de Períodos de Revisão de Vidas Úteis"}),a.jsx(pa,{onNew:_e,onSave:Xe,onEdit:()=>u&&ae(ie.find(e=>e.id===u)),onDelete:()=>u&&Qe(u),onPrint:()=>window.print(),onExportPdf:sa,onExportExcel:ea,canEditDelete:!!u})]}),a.jsxs("div",{className:"grid grid-cols-1 2xl:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 p-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsx(p,{label:s("period_code")||"Código da Revisão",name:"codigo",value:r.codigo,onChange:()=>{},disabled:!0}),a.jsxs(Ce,{label:s("status")||"Status",name:"status",value:r.status,onChange:w,disabled:x,children:[a.jsx("option",{value:"Aberto",children:s("open_status")||"Aberto"}),a.jsx("option",{value:"Em Andamento",children:s("in_progress_status")||"Em Andamento"}),a.jsx("option",{value:"Fechado",children:s("closed_status")||"Fechado"})]}),a.jsx(p,{label:s("period_description")||"Descrição do Período",name:"descricao",value:r.descricao,onChange:w,error:y.descricao,disabled:x}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(p,{className:"w-full",label:s("company_label")||"Empresa",name:"empresa_nome",value:ge?ge.name:"",onChange:()=>{},error:y.empresa_id,disabled:!0})}),a.jsx(h,{variant:"secondary",onClick:()=>B(!0),disabled:x,title:s("search_company")||"Buscar Empresa","aria-label":s("search_company")||"Buscar Empresa",className:"p-0 h-10 w-10 justify-center",children:a.jsx(re,{size:18})})]}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(p,{className:"w-full",label:s("ug_label")||"UG - Unidade Gerencial",name:"ug_nome",value:te?`${te.codigo} - ${te.nome}`:"",onChange:()=>{},error:y.ug_id,disabled:!0})}),a.jsx(h,{variant:"secondary",onClick:()=>q(!0),disabled:x||!r.empresa_id,title:s("search_ug")||"Buscar UG","aria-label":s("search_ug")||"Buscar UG",className:"p-0 h-10 w-10 justify-center",children:a.jsx(re,{size:18})})]}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(p,{className:"w-full",label:s("review_responsible")||"Responsável pela Revisão",name:"responsavel_nome",value:je?je.nome_completo:"",onChange:()=>{},error:y.responsavel_id,disabled:!0})}),a.jsx(h,{variant:"secondary",onClick:()=>z(!0),disabled:x||!r.empresa_id,title:s("search_employee")||"Buscar Colaborador","aria-label":s("search_employee")||"Buscar Colaborador",className:"p-0 h-10 w-10 justify-center",children:a.jsx(re,{size:18})})]}),a.jsx(p,{type:"date",label:s("open_date")||"Data de Abertura",name:"data_abertura",value:r.data_abertura,onChange:w,error:y.data_abertura,disabled:x}),a.jsx(p,{type:"date",label:s("start_new_useful_life")||"Início Nova Vida Útil",name:"data_inicio_nova_vida_util",value:r.data_inicio_nova_vida_util,onChange:w,error:y.data_inicio_nova_vida_util,disabled:x}),a.jsx(p,{type:"date",label:s("expected_close_date")||"Data de Fechamento Prevista",name:"data_fechamento_prevista",value:r.data_fechamento_prevista,onChange:w,error:y.data_fechamento_prevista,disabled:x}),a.jsx(p,{type:"date",label:s("close_date")||"Data de Fechamento",name:"data_fechamento",value:r.data_fechamento,onChange:w,disabled:!0}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(p,{label:s("observations")||"Observações",name:"observacoes",value:r.observacoes,onChange:w,multiline:!0,disabled:x})})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[a.jsx("a",{href:"/Base%20de%20dados.xlsx",download:!0,className:"inline-flex items-center justify-center p-0 h-10 w-10 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",title:s("download_template")||"Baixar planilha modelo","aria-label":s("download_template")||"Baixar planilha modelo",children:a.jsx(Ee,{size:18})}),a.jsx(h,{variant:"secondary",onClick:Ye,disabled:x||!u,title:s("upload_base")||"Upload Base","aria-label":s("upload_base")||"Upload Base",className:"px-2 py-2",children:a.jsx(Re,{size:18})}),a.jsx(h,{variant:"danger",onClick:He,disabled:!u||x,title:s("close_period")||"Fechar Período","aria-label":s("close_period")||"Fechar Período",className:"px-2 py-2",children:a.jsx(wa,{size:18})}),a.jsx("input",{type:"file",accept:".csv,.xlsx",ref:se,onChange:he,className:"hidden"})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 p-3",children:[a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 mb-3 min-w-0",children:[a.jsx("input",{className:"px-3 py-2 rounded-md border bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 border-slate-300 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-400 flex-1 min-w-0",placeholder:s("search_periods_placeholder")||"Pesquisar por código, descrição ou status",value:ue,onChange:e=>Ae(e.target.value)}),a.jsxs(Ce,{label:"",name:"statusFilter",value:Q,onChange:e=>Be(e.target.value),children:[a.jsx("option",{value:"",children:s("all")||"Todos"}),a.jsx("option",{value:"Aberto",children:s("review_status_open")||"Aberto"}),a.jsx("option",{value:"Em Andamento",children:s("review_status_in_progress")||"Em Andamento"}),a.jsx("option",{value:"Fechado",children:s("review_status_closed")||"Fechado"})]})]}),de&&a.jsx("p",{className:"text-slate-500",children:s("backend_checking")||"Checando backend..."}),ce&&a.jsx("p",{className:"text-red-600",children:s("backend_error")||"Erro no backend"}),!de&&!ce&&(E.length===0?a.jsx("p",{className:"text-slate-500",children:s("no_periods_found")||"Nenhum período encontrado."}):a.jsxs(a.Fragment,{children:[a.jsx(_a,{columns:Ze,data:E,onRowClick:ae}),a.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300 mt-3",children:s("periods_count",{count:E.length})||`${E.length} períodos`})]}))]})]}),Le&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>B(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_company_title")||"Buscar Empresa"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>B(!1),children:a.jsx(A,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(p,{label:s("search")||"Pesquisar",name:"companySearch",value:T,onChange:e=>G(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:fe.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_companies_found")||"Nenhuma empresa encontrada."}):fe.map(e=>a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{S(t=>({...t,empresa_id:String(e.id)})),B(!1),G("")},children:[a.jsx("div",{className:"font-medium",children:e.name}),e.cnpj&&a.jsxs("div",{className:"text-xs text-slate-500",children:[s("cnpj")||"CNPJ",": ",e.cnpj]})]},e.id))})]})]})})]}),$e&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>z(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_employee_title")||"Buscar Colaborador"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>z(!1),children:a.jsx(A,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(p,{label:s("search")||"Pesquisar",name:"respQuery",value:V,onChange:e=>X(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:we.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_employees_found")||"Nenhum colaborador encontrado."}):a.jsx(a.Fragment,{children:we.map(e=>a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{const t=String(e.cpf||"").replace(/\D/g,""),o=String(e.email_corporativo||"").toLowerCase(),d=D.find(n=>{const m=String(n.cpf||"").replace(/\D/g,""),g=String(n.email||"").toLowerCase();return t&&m===t||o&&g===o});d?(S(n=>({...n,responsavel_id:String(d.id)})),z(!1),X(""),F(n=>({...n,responsavel_id:null})),c.success(s("responsible_selected")||"Responsável selecionado")):(c.error(s("employee_no_user")||"Colaborador não possui usuário vinculado"),F(n=>({...n,responsavel_id:s("user_not_found_for_employee")||"Usuário não encontrado para o colaborador selecionado"})))},children:[a.jsx("div",{className:"font-medium",children:e.full_name}),e.email_corporativo?a.jsx("div",{className:"text-xs text-slate-500",children:e.email_corporativo}):null]},e.id))})})]})]})})]}),qe&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>q(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_ug_title")||"Buscar UG"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>q(!1),children:a.jsx(A,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(p,{label:s("search")||"Pesquisar",name:"ugQuery",value:Y,onChange:e=>W(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:ye.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_ugs_found")||"Nenhuma UG encontrada."}):ye.map(e=>{var t;return a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{S(o=>({...o,ug_id:String(e.id)})),q(!1),W(""),F(o=>({...o,ug_id:null}))},children:[a.jsxs("div",{className:"font-medium",children:[e.codigo," - ",e.nome]}),a.jsxs("div",{className:"text-xs text-slate-500",children:[s("company_colon")||"Empresa:"," ",((t=k.find(o=>o.id===e.empresa_id))==null?void 0:t.name)||"—"]})]},e.id)})})]})]})})]}),Ie&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>I(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("upload_base_title")||"Upload Base (.csv/.xlsx)"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>I(!1),children:a.jsx(A,{size:18})})]}),a.jsxs("div",{className:"p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("a",{href:"/Base%20de%20dados.xlsx",download:!0,className:"inline-flex items-center justify-center p-0 h-9 w-9 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",title:s("download_template")||"Baixar planilha modelo","aria-label":s("download_template")||"Baixar planilha modelo",children:a.jsx(Ee,{size:18})}),a.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:s("upload_template_hint")||"Use esta planilha; a ordem das colunas está definida nela."})]}),a.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center ${Oe?"border-blue-400 bg-blue-50 dark:bg-slate-900/40":"border-slate-300 dark:border-slate-700"}`,onDragOver:e=>{e.preventDefault(),O(!0)},onDragLeave:()=>O(!1),onDrop:We,children:b?a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:b.name}),a.jsxs("div",{className:"text-xs text-slate-500",children:[Math.round(b.size/1024)," KB"]}),!P&&!_&&a.jsx("div",{className:"mt-2 text-xs text-slate-600",children:s("file_selected_click_send")||"Arquivo selecionado. Clique 'Enviar arquivo' para iniciar."}),a.jsx("div",{className:"mt-3 flex justify-center",children:a.jsx(h,{variant:"primary",onClick:be,disabled:P,className:"px-3 py-2",children:P?s("sending")||"Enviando...":s("send_file")||"Enviar arquivo"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:s("drag_drop_here")||"Arraste e solte o arquivo aqui"}),a.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s("file_formats")||"Formatos: .csv ou .xlsx"}),a.jsxs("div",{className:"mt-3",children:[a.jsxs(h,{variant:"secondary",onClick:()=>{var e;return(e=se.current)==null?void 0:e.click()},className:"px-3 py-2",children:[a.jsx(Re,{size:18})," ",s("select_file")||"Selecionar arquivo"]}),a.jsx("input",{type:"file",accept:".csv,.xlsx",ref:se,onChange:he,className:"hidden"})]})]})}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(h,{variant:"secondary",onClick:()=>{I(!1),J(null),K(null)},className:"px-3 py-2",children:s("close")||"Fechar"}),a.jsx(h,{variant:"primary",onClick:be,disabled:!b||P,className:"px-3 py-2",children:P?s("sending")||"Enviando...":s("send_file")||"Enviar arquivo"})]}),_&&a.jsxs("div",{className:"mt-2 text-sm",children:[a.jsx("div",{className:"font-medium",children:s("import_result_title")||"Resultado da importação"}),a.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:s("import_result_counts",{imported:_.importados,rejected:_.rejeitados})||`Importados: ${_.importados} • Rejeitados: ${_.rejeitados}`}),_.erros&&_.erros.length>0&&a.jsxs("details",{className:"mt-2",children:[a.jsx("summary",{className:"cursor-pointer text-slate-600",children:s("view_errors")||"Ver erros"}),a.jsx("ul",{className:"mt-2 max-h-40 overflow-y-auto text-xs list-disc pl-5",children:_.erros.slice(0,50).map((e,t)=>a.jsx("li",{children:e},t))})]}),_.alertas&&_.alertas.length>0&&a.jsxs("details",{className:"mt-2",children:[a.jsx("summary",{className:"cursor-pointer text-slate-600",children:s("view_warnings")||"Ver alertas"}),a.jsx("ul",{className:"mt-2 max-h-40 overflow-y-auto text-xs list-disc pl-5",children:_.alertas.slice(0,50).map((e,t)=>a.jsx("li",{children:e},t))})]})]})]})]})})]}),Ge&&a.jsxs("div",{className:"fixed inset-0 z-[60]",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>U(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-md bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("confirm_blank_years_title")||"Confirmar vida útil em branco"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>U(!1),children:a.jsx(A,{size:18})})]}),a.jsxs("div",{className:"p-4 space-y-3",children:[a.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:s("confirm_blank_years_msg",{count:pe})||`Foram encontrados ${pe} itens com Vida útil (anos) em branco. Eles serão rejeitados. Deseja prosseguir?`}),ee&&ee.length>0&&a.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[s("lines_example")||"Exemplos de linhas:"," ",ee.join(", ")]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(h,{variant:"secondary",onClick:()=>U(!1),className:"px-3 py-2",children:s("cancel")||"Cancelar"}),a.jsx(h,{variant:"primary",onClick:()=>{U(!1),ve()},className:"px-3 py-2",children:s("proceed")||"Prosseguir"})]})]})]})})]})]})}export{Ca as default};
