import{c as te,u as Je,a as Ke,R as i,g as Ze,b as Ye,d as ea,e as aa,f as sa,j as a,A as ta,I as m,S as ye,B as x,h as se,T as ra,m as q,X as M,z as n,i as oa,k as ia,l as da,n as la,o as na,p as ca,_ as ua}from"./index-CyNa9eyx.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],we=te("file-down",ma);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_a=te("lock",pa);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ne=te("upload",xa);function va(){const{t:s}=Je();Ke();const[re,ke]=i.useState([]),[oe,Ce]=i.useState([]),[j,Se]=i.useState([]),[E,Ee]=i.useState([]),[Re,F]=i.useState(!1),[I,O]=i.useState(""),[De,L]=i.useState(!1),[G,T]=i.useState(""),[ie,de]=i.useState(!0),[le,ne]=i.useState(null),[ce,Pe]=i.useState(""),[Q,Ue]=i.useState(""),[c,V]=i.useState(null),[v,R]=i.useState({}),[y,$e]=i.useState([]),[Fe,B]=i.useState(!1),[X,H]=i.useState(""),[Le,A]=i.useState(!1),[Be,z]=i.useState(!1),[w,W]=i.useState(null),[_,J]=i.useState(null),[D,K]=i.useState(!1),[r,N]=i.useState({descricao:"",data_abertura:"",data_inicio_nova_vida_util:"",data_fechamento_prevista:"",data_fechamento:"",empresa_id:"",responsavel_id:"",ug_id:"",status:"Aberto",observacoes:"",codigo:""}),P=i.useCallback(()=>{de(!0),ne(null),Promise.all([Ze(),Ye(),ea(),aa(),sa()]).then(([e,t,o,d,l])=>{ke(e||[]),Ce(t||[]),Se(o||[]),Ee(d||[]),$e(l||[])}).catch(e=>ne(e.message||s("error_generic")||"Erro")).finally(()=>de(!1))},[]);i.useEffect(()=>{P()},[P]);const ue=()=>{V(null),R({}),N({descricao:"",data_abertura:"",data_inicio_nova_vida_util:"",data_fechamento_prevista:"",data_fechamento:"",empresa_id:"",responsavel_id:"",ug_id:"",status:"Aberto",observacoes:"",codigo:""}),O(""),T(""),H("")},b=e=>{const{name:t,value:o}=e.target;N(d=>({...d,[t]:o}))},Ae=()=>{const e={};return r.descricao||(e.descricao="Descrição é obrigatória"),r.data_abertura||(e.data_abertura="Data de abertura é obrigatória"),r.data_inicio_nova_vida_util||(e.data_inicio_nova_vida_util=s("field_required")||"Início da nova vida útil é obrigatório"),r.data_fechamento_prevista||(e.data_fechamento_prevista="Data de fechamento prevista é obrigatória"),r.empresa_id||(e.empresa_id="Empresa é obrigatória"),r.ug_id||(e.ug_id="UG é obrigatória"),r.responsavel_id||(e.responsavel_id=s("field_required")||"Responsável é obrigatório"),["Aberto","Em Andamento","Fechado"].includes(r.status)||(e.status=s("invalid_status")||"Status inválido"),R(e),Object.keys(e).length===0},ze=async()=>{if(Ae())try{if(c){const e={descricao:r.descricao,data_abertura:r.data_abertura||void 0,data_inicio_nova_vida_util:r.data_inicio_nova_vida_util||void 0,data_fechamento_prevista:r.data_fechamento_prevista||void 0,data_fechamento:r.data_fechamento||void 0,empresa_id:r.empresa_id?Number(r.empresa_id):void 0,responsavel_id:r.responsavel_id?Number(r.responsavel_id):void 0,ug_id:r.ug_id?Number(r.ug_id):void 0,status:r.status,observacoes:r.observacoes||void 0};await ia(c,e),n.success(s("updated_successfully")||"Período atualizado com sucesso")}else{const e={descricao:r.descricao,data_abertura:r.data_abertura,data_inicio_nova_vida_util:r.data_inicio_nova_vida_util,data_fechamento_prevista:r.data_fechamento_prevista,empresa_id:Number(r.empresa_id),responsavel_id:Number(r.responsavel_id),ug_id:Number(r.ug_id),status:r.status,observacoes:r.observacoes||null},t=await oa(e);n.success(s("created_successfully")||"Período criado com sucesso"),V(t.id)}await P()}catch(e){n.error(e.message||s("error_saving")||"Erro ao salvar")}},Z=e=>{V(e.id),N({descricao:e.descricao||"",data_abertura:e.data_abertura||"",data_inicio_nova_vida_util:e.data_inicio_nova_vida_util||"",data_fechamento_prevista:e.data_fechamento_prevista||"",data_fechamento:e.data_fechamento||"",empresa_id:String(e.empresa_id||""),responsavel_id:String(e.responsavel_id||""),ug_id:String(e.ug_id||""),status:e.status||"Aberto",observacoes:e.observacoes||"",codigo:e.codigo||""})},qe=async e=>{if(confirm(s("confirm_delete_period")||"Confirmar exclusão do período?"))try{await da(e),n.success(s("deleted_successfully")||"Período excluído"),c===e&&ue(),await P()}catch(t){n.error(t.message||s("error_deleting")||"Erro ao excluir")}},Me=async()=>{if(!c)return n.error(s("select_period_msg")||"Selecione um período");try{const e=await la(c);n.success(s("period_closed")||"Período fechado"),Z(e),await P()}catch(e){n.error(e.message||s("error_closing_period")||"Erro ao fechar período")}},Y=i.useRef(null),Ie=()=>{if(!c)return n.error(s("select_period_msg")||"Selecione um período");if(r.status==="Fechado")return n.error(s("period_closed_upload_not_allowed")||"Período está fechado. Upload não permitido.");A(!0),z(!1),K(!1),W(null),J(null)},me=e=>{if(!e)return;const t=(e.name||"").toLowerCase();if(!(t.endsWith(".csv")||t.endsWith(".xlsx"))){n.error(s("invalid_file_format")||"Formato inválido. Envie .csv ou .xlsx");return}W(e)},pe=e=>{var o;const t=(o=e.target.files)==null?void 0:o[0];e.target.value="",t&&me(t)},Oe=e=>{var o,d;e.preventDefault(),z(!1);const t=(d=(o=e.dataTransfer)==null?void 0:o.files)==null?void 0:d[0];t&&me(t)},_e=async()=>{if(!c)return n.error(s("select_period_msg")||"Selecione um período");if(!w)return n.error(s("select_file_msg")||"Selecione um arquivo");try{K(!0);const e=await na(c,w);J(e),n.success(s("import_summary",{imported:e.importados,rejected:e.rejeitados})||`Importação: ${e.importados} importados, ${e.rejeitados} rejeitados.`);try{await ca(c)}catch{}}catch(e){n.error(e.message||s("upload_failed")||"Falha no upload")}finally{K(!1)}},k=(re||[]).filter(e=>!Q||e.status===Q).filter(e=>{const t=ce.toLowerCase();return(e.codigo||"").toLowerCase().includes(t)||(e.descricao||"").toLowerCase().includes(t)||(e.status||"").toLowerCase().includes(t)}).sort((e,t)=>e.id<t.id?1:-1),Ge=[{key:"codigo",header:s("period_code")||"Código",width:120},{key:"descricao",header:s("period_description")||"Descrição do Período"},{key:"data_abertura",header:s("open_date")||"Data de Abertura",width:140},{key:"empresa_id",header:s("company_label")||"Empresa",width:220,render:e=>{const t=j.find(o=>o.id===e);return t?t.name:"—"}},{key:"ug_id",header:s("ug_label")||"UG",width:220,render:e=>{const t=y.find(o=>o.id===e);return t?`${t.codigo} - ${t.nome}`:"—"}},{key:"responsavel_id",header:s("review_responsible")||"Responsável",width:220,render:e=>{const t=E.find(o=>o.id===e);return t?t.nome_completo:"—"}},{key:"status",header:s("status")||"Status",width:140}],C=e=>{if(!e)return"";try{return new Date(e).toLocaleDateString("pt-BR")}catch{return String(e||"")}},Te=async()=>{const e=[s("period_code")||"Código da Revisão",s("period_description")||"Descrição do Período",s("company_label")||"Empresa",s("ug_label")||"UG",s("review_responsible")||"Responsável pela Revisão",s("open_date")||"Data de Abertura",s("start_new_useful_life")||"Início Nova Depreciação",s("close_date")||"Data de Fechamento"],t=k.map(u=>{var fe,je;const ae=((fe=j.find(f=>f.id===u.empresa_id))==null?void 0:fe.name)||"",Xe=(()=>{const f=y.find(We=>We.id===u.ug_id);return f?`${f.codigo} - ${f.nome}`:""})(),He=((je=E.find(f=>f.id===u.responsavel_id))==null?void 0:je.nome_completo)||"";return{[e[0]]:u.codigo||"",[e[1]]:u.descricao||"",[e[2]]:ae,[e[3]]:Xe,[e[4]]:He,[e[5]]:C(u.data_abertura),[e[6]]:C(u.data_inicio_nova_vida_util),[e[7]]:C(u.data_fechamento)}}),o=await ua(()=>import("./xlsx-D_0l8YDs.js"),[]),d=o.default||o,l=d.utils.json_to_sheet(t,{header:e}),h=d.utils.book_new();d.utils.book_append_sheet(h,l,"Períodos");const g=d.write(h,{bookType:"xlsx",type:"array"}),U=new Blob([g],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),$=URL.createObjectURL(U),S=document.createElement("a");S.href=$,S.download="Periodos_Revisao.xlsx",S.click(),URL.revokeObjectURL($),n.success(s("export_excel")||"Exportar Excel")},Qe=()=>{const e=s("review_periods_register_title")||"Períodos de Revisão de Vidas Úteis",t=`
      <tr>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("period_code")||"Código da Revisão"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("period_description")||"Descrição do Período"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("company_label")||"Empresa"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("ug_label")||"UG"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("review_responsible")||"Responsável pela Revisão"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("open_date")||"Data de Abertura"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("start_new_useful_life")||"Início Nova Depreciação"}</th>
        <th style="padding:8px;border:1px solid #e5e7eb">${s("close_date")||"Data de Fechamento"}</th>
      </tr>`,o=k.map(l=>{var $,S;const h=(($=j.find(u=>u.id===l.empresa_id))==null?void 0:$.name)||"",g=(()=>{const u=y.find(ae=>ae.id===l.ug_id);return u?`${u.codigo} - ${u.nome}`:""})(),U=((S=E.find(u=>u.id===l.responsavel_id))==null?void 0:S.nome_completo)||"";return`
        <tr>
          <td style="padding:8px;border:1px solid #e5e7eb">${l.codigo||""}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${l.descricao||""}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${h}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${g}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${U}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${C(l.data_abertura)}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${C(l.data_inicio_nova_vida_util)}</td>
          <td style="padding:8px;border:1px solid #e5e7eb">${C(l.data_fechamento)}</td>
        </tr>`}).join("");return`<!doctype html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>${e}</title>
        <style>
          @page { margin: 20mm; }
          body { font-family: Arial, sans-serif; color: #0f172a; }
          .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
          .brand { display:flex; align-items:center; gap:10px; }
          .brand img { height:40px; }
          .brand .title { font-size:18px; font-weight:600; }
          table { width:100%; border-collapse: collapse; }
          thead { background:#f8fafc; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="brand">
            <img src="/brand.svg" alt="Logo" />
            <div class="title">${e}</div>
          </div>
          <div style="font-size:12px;color:#64748b">${new Date().toLocaleString("pt-BR")}</div>
        </div>
        <table>
          <thead>${t}</thead>
          <tbody>${o}</tbody>
        </table>
      </body>
      </html>`},Ve=()=>{const e=window.open("","PRINT","height=800,width=900");e.document.write(Qe()),e.document.close(),e.focus(),e.print(),e.close(),n.success(s("export_pdf")||"Exportar PDF")},p=r.status==="Fechado",xe=j.find(e=>e.id===Number(r.empresa_id)),he=j.filter(e=>!I||(e.name||"").toLowerCase().includes(I.toLowerCase())),ve=E.find(e=>e.id===Number(r.responsavel_id)),ee=y.find(e=>e.id===Number(r.ug_id)),be=i.useMemo(()=>{const e=(X||"").trim().toLowerCase();let t=y||[];return r.empresa_id&&(t=t.filter(o=>String(o.empresa_id)===String(r.empresa_id))),e?t.filter(o=>String(o.codigo||"").toLowerCase().includes(e)||String(o.nome||"").toLowerCase().includes(e)).slice(0,100):t.slice(0,50)},[X,y,r.empresa_id]),ge=i.useMemo(()=>{const e=(G||"").trim().toLowerCase();let t=oe||[];if(r.empresa_id&&(t=t.filter(d=>String(d.empresa_id)===String(r.empresa_id))),t=t.filter(d=>String(d.status||"").toLowerCase()==="ativo"),!e)return t.slice(0,100);const o=e.replace(/\D/g,"");return t.filter(d=>{const l=String(d.full_name||"").toLowerCase(),h=String(d.email_corporativo||"").toLowerCase(),g=String(d.cpf||"").replace(/\D/g,""),U=String(d.matricula||"").toLowerCase();return l.includes(e)||h.includes(e)||U.includes(e)||o&&g.includes(o)}).slice(0,100)},[G,oe,r.empresa_id]);return a.jsxs("section",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[a.jsx("h2",{className:"text-2xl font-semibold text-slate-900 dark:text-slate-100",children:s("review_periods_register_title")||"Cadastro de Períodos de Revisão de Vidas Úteis"}),a.jsx(ta,{onNew:ue,onSave:ze,onEdit:()=>c&&Z(re.find(e=>e.id===c)),onDelete:()=>c&&qe(c),onPrint:()=>window.print(),onExportPdf:Ve,onExportExcel:Te,canEditDelete:!!c})]}),a.jsxs("div",{className:"grid grid-cols-1 2xl:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 p-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsx(m,{label:s("period_code")||"Código da Revisão",name:"codigo",value:r.codigo,onChange:()=>{},disabled:!0}),a.jsxs(ye,{label:s("status")||"Status",name:"status",value:r.status,onChange:b,disabled:p,children:[a.jsx("option",{value:"Aberto",children:s("open_status")||"Aberto"}),a.jsx("option",{value:"Em Andamento",children:s("in_progress_status")||"Em Andamento"}),a.jsx("option",{value:"Fechado",children:s("closed_status")||"Fechado"})]}),a.jsx(m,{label:s("period_description")||"Descrição do Período",name:"descricao",value:r.descricao,onChange:b,error:v.descricao,disabled:p}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(m,{className:"w-full",label:s("company_label")||"Empresa",name:"empresa_nome",value:xe?xe.name:"",onChange:()=>{},error:v.empresa_id,disabled:!0})}),a.jsx(x,{variant:"secondary",onClick:()=>F(!0),disabled:p,title:s("search_company")||"Buscar Empresa","aria-label":s("search_company")||"Buscar Empresa",className:"p-0 h-10 w-10 justify-center",children:a.jsx(se,{size:18})})]}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(m,{className:"w-full",label:s("ug_label")||"UG - Unidade Gerencial",name:"ug_nome",value:ee?`${ee.codigo} - ${ee.nome}`:"",onChange:()=>{},error:v.ug_id,disabled:!0})}),a.jsx(x,{variant:"secondary",onClick:()=>B(!0),disabled:p||!r.empresa_id,title:s("search_ug")||"Buscar UG","aria-label":s("search_ug")||"Buscar UG",className:"p-0 h-10 w-10 justify-center",children:a.jsx(se,{size:18})})]}),a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 min-w-0",children:[a.jsx("div",{className:"min-w-0",children:a.jsx(m,{className:"w-full",label:s("review_responsible")||"Responsável pela Revisão",name:"responsavel_nome",value:ve?ve.nome_completo:"",onChange:()=>{},error:v.responsavel_id,disabled:!0})}),a.jsx(x,{variant:"secondary",onClick:()=>L(!0),disabled:p||!r.empresa_id,title:s("search_employee")||"Buscar Colaborador","aria-label":s("search_employee")||"Buscar Colaborador",className:"p-0 h-10 w-10 justify-center",children:a.jsx(se,{size:18})})]}),a.jsx(m,{type:"date",label:s("open_date")||"Data de Abertura",name:"data_abertura",value:r.data_abertura,onChange:b,error:v.data_abertura,disabled:p}),a.jsx(m,{type:"date",label:s("start_new_useful_life")||"Início Nova Vida Útil",name:"data_inicio_nova_vida_util",value:r.data_inicio_nova_vida_util,onChange:b,error:v.data_inicio_nova_vida_util,disabled:p}),a.jsx(m,{type:"date",label:s("expected_close_date")||"Data de Fechamento Prevista",name:"data_fechamento_prevista",value:r.data_fechamento_prevista,onChange:b,error:v.data_fechamento_prevista,disabled:p}),a.jsx(m,{type:"date",label:s("close_date")||"Data de Fechamento",name:"data_fechamento",value:r.data_fechamento,onChange:b,disabled:!0}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(m,{label:s("observations")||"Observações",name:"observacoes",value:r.observacoes,onChange:b,multiline:!0,disabled:p})})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[a.jsx("a",{href:"/Base%20de%20dados.xlsx",download:!0,className:"inline-flex items-center justify-center p-0 h-10 w-10 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",title:s("download_template")||"Baixar planilha modelo","aria-label":s("download_template")||"Baixar planilha modelo",children:a.jsx(we,{size:18})}),a.jsx(x,{variant:"secondary",onClick:Ie,disabled:p||!c,title:s("upload_base")||"Upload Base","aria-label":s("upload_base")||"Upload Base",className:"px-2 py-2",children:a.jsx(Ne,{size:18})}),a.jsx(x,{variant:"danger",onClick:Me,disabled:!c||p,title:s("close_period")||"Fechar Período","aria-label":s("close_period")||"Fechar Período",className:"px-2 py-2",children:a.jsx(_a,{size:18})}),a.jsx("input",{type:"file",accept:".csv,.xlsx",ref:Y,onChange:pe,className:"hidden"})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 p-3",children:[a.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-end gap-2 mb-3 min-w-0",children:[a.jsx("input",{className:"px-3 py-2 rounded-md border bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 border-slate-300 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-400 flex-1 min-w-0",placeholder:s("search_periods_placeholder")||"Pesquisar por código, descrição ou status",value:ce,onChange:e=>Pe(e.target.value)}),a.jsxs(ye,{label:"",name:"statusFilter",value:Q,onChange:e=>Ue(e.target.value),children:[a.jsx("option",{value:"",children:s("all")||"Todos"}),a.jsx("option",{value:"Aberto",children:s("review_status_open")||"Aberto"}),a.jsx("option",{value:"Em Andamento",children:s("review_status_in_progress")||"Em Andamento"}),a.jsx("option",{value:"Fechado",children:s("review_status_closed")||"Fechado"})]})]}),ie&&a.jsx("p",{className:"text-slate-500",children:s("backend_checking")||"Checando backend..."}),le&&a.jsx("p",{className:"text-red-600",children:s("backend_error")||"Erro no backend"}),!ie&&!le&&(k.length===0?a.jsx("p",{className:"text-slate-500",children:s("no_periods_found")||"Nenhum período encontrado."}):a.jsxs(a.Fragment,{children:[a.jsx(ra,{columns:Ge,data:k,onRowClick:Z}),a.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-300 mt-3",children:s("periods_count",{count:k.length})||`${k.length} períodos`})]}))]})]}),Re&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>F(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_company_title")||"Buscar Empresa"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>F(!1),children:a.jsx(M,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(m,{label:s("search")||"Pesquisar",name:"companySearch",value:I,onChange:e=>O(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:he.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_companies_found")||"Nenhuma empresa encontrada."}):he.map(e=>a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{N(t=>({...t,empresa_id:String(e.id)})),F(!1),O("")},children:[a.jsx("div",{className:"font-medium",children:e.name}),e.cnpj&&a.jsxs("div",{className:"text-xs text-slate-500",children:[s("cnpj")||"CNPJ",": ",e.cnpj]})]},e.id))})]})]})})]}),De&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>L(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_employee_title")||"Buscar Colaborador"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>L(!1),children:a.jsx(M,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(m,{label:s("search")||"Pesquisar",name:"respQuery",value:G,onChange:e=>T(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:ge.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_employees_found")||"Nenhum colaborador encontrado."}):a.jsx(a.Fragment,{children:ge.map(e=>a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{const t=String(e.cpf||"").replace(/\D/g,""),o=String(e.email_corporativo||"").toLowerCase(),d=E.find(l=>{const h=String(l.cpf||"").replace(/\D/g,""),g=String(l.email||"").toLowerCase();return t&&h===t||o&&g===o});d?(N(l=>({...l,responsavel_id:String(d.id)})),L(!1),T(""),R(l=>({...l,responsavel_id:null})),n.success(s("responsible_selected")||"Responsável selecionado")):(n.error(s("employee_no_user")||"Colaborador não possui usuário vinculado"),R(l=>({...l,responsavel_id:s("user_not_found_for_employee")||"Usuário não encontrado para o colaborador selecionado"})))},children:[a.jsx("div",{className:"font-medium",children:e.full_name}),e.email_corporativo?a.jsx("div",{className:"text-xs text-slate-500",children:e.email_corporativo}):null]},e.id))})})]})]})})]}),Fe&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>B(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("search_ug_title")||"Buscar UG"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>B(!1),children:a.jsx(M,{size:18})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(m,{label:s("search")||"Pesquisar",name:"ugQuery",value:X,onChange:e=>H(e.target.value)}),a.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto divide-y divide-slate-200 dark:divide-slate-800",children:be.length===0?a.jsx("div",{className:"text-slate-500",children:s("no_ugs_found")||"Nenhuma UG encontrada."}):be.map(e=>{var t;return a.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>{N(o=>({...o,ug_id:String(e.id)})),B(!1),H(""),R(o=>({...o,ug_id:null}))},children:[a.jsxs("div",{className:"font-medium",children:[e.codigo," - ",e.nome]}),a.jsxs("div",{className:"text-xs text-slate-500",children:[s("company_colon")||"Empresa:"," ",((t=j.find(o=>o.id===e.empresa_id))==null?void 0:t.name)||"—"]})]},e.id)})})]})]})})]}),Le&&a.jsxs("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(!1)}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-xl bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-800",children:[a.jsx("div",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s("upload_base_title")||"Upload Base (.csv/.xlsx)"}),a.jsx("button",{className:"p-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900",onClick:()=>A(!1),children:a.jsx(M,{size:18})})]}),a.jsxs("div",{className:"p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("a",{href:"/Base%20de%20dados.xlsx",download:!0,className:"inline-flex items-center justify-center p-0 h-9 w-9 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800",title:s("download_template")||"Baixar planilha modelo","aria-label":s("download_template")||"Baixar planilha modelo",children:a.jsx(we,{size:18})}),a.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:s("upload_template_hint")||"Use esta planilha; a ordem das colunas está definida nela."})]}),a.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center ${Be?"border-blue-400 bg-blue-50 dark:bg-slate-900/40":"border-slate-300 dark:border-slate-700"}`,onDragOver:e=>{e.preventDefault(),z(!0)},onDragLeave:()=>z(!1),onDrop:Oe,children:w?a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:w.name}),a.jsxs("div",{className:"text-xs text-slate-500",children:[Math.round(w.size/1024)," KB"]}),!D&&!_&&a.jsx("div",{className:"mt-2 text-xs text-slate-600",children:s("file_selected_click_send")||"Arquivo selecionado. Clique 'Enviar arquivo' para iniciar."}),a.jsx("div",{className:"mt-3 flex justify-center",children:a.jsx(x,{variant:"primary",onClick:_e,disabled:D,className:"px-3 py-2",children:D?s("sending")||"Enviando...":s("send_file")||"Enviar arquivo"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:s("drag_drop_here")||"Arraste e solte o arquivo aqui"}),a.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s("file_formats")||"Formatos: .csv ou .xlsx"}),a.jsxs("div",{className:"mt-3",children:[a.jsxs(x,{variant:"secondary",onClick:()=>{var e;return(e=Y.current)==null?void 0:e.click()},className:"px-3 py-2",children:[a.jsx(Ne,{size:18})," ",s("select_file")||"Selecionar arquivo"]}),a.jsx("input",{type:"file",accept:".csv,.xlsx",ref:Y,onChange:pe,className:"hidden"})]})]})}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(x,{variant:"secondary",onClick:()=>{A(!1),W(null),J(null)},className:"px-3 py-2",children:s("close")||"Fechar"}),a.jsx(x,{variant:"primary",onClick:_e,disabled:!w||D,className:"px-3 py-2",children:D?s("sending")||"Enviando...":s("send_file")||"Enviar arquivo"})]}),_&&a.jsxs("div",{className:"mt-2 text-sm",children:[a.jsx("div",{className:"font-medium",children:s("import_result_title")||"Resultado da importação"}),a.jsx("div",{className:"text-slate-700 dark:text-slate-300",children:s("import_result_counts",{imported:_.importados,rejected:_.rejeitados})||`Importados: ${_.importados} • Rejeitados: ${_.rejeitados}`}),_.erros&&_.erros.length>0&&a.jsxs("details",{className:"mt-2",children:[a.jsx("summary",{className:"cursor-pointer text-slate-600",children:s("view_errors")||"Ver erros"}),a.jsx("ul",{className:"mt-2 max-h-40 overflow-y-auto text-xs list-disc pl-5",children:_.erros.slice(0,50).map((e,t)=>a.jsx("li",{children:e},t))})]})]})]})]})})]})]})}export{va as default};
